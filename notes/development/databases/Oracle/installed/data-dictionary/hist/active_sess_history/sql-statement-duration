$ DBA_HIST_ACTIVE_SESS_HISTORY: Query duration of SQL statement executions

code {
with x as (
   select
      ash.sample_time, -- ash.sample_time_utc,
      ash.sql_exec_start,
      usr.username,
      txt.sql_text,
   
      row_number() over (partition by ash.session_id, ash.session_serial#, ash.sql_id, ash.sql_exec_id order by ash.sample_time     ) first_rec_for_sql_exec,
      row_number() over (partition by ash.session_id, ash.session_serial#, ash.sql_id, ash.sql_exec_id order by ash.sample_time desc)  last_rec_for_sql_exec,
      --
      ash.sql_id, ash.sql_child_number, ash.sql_exec_id
   from
      sys.dba_hist_active_sess_history     ash                               left join
      sys.dba_hist_sqltext                 txt on ash.sql_id  = txt.sql_id   left join
      sys.dba_users                        usr on ash.user_id = usr.user_id
)
select
   x.sql_id, x.sql_child_number, x.sql_exec_id,
   x.sql_exec_start,
   x.username,
   min (case when x.first_rec_for_sql_exec =1 then x.sample_time end) first_sample_time,
   max (case when x. last_rec_for_sql_exec =1 then x.sample_time end)  last_sample_time,
   cast(substr(x.sql_text, 1, 1000) as varchar2(1000)),
   count(*)                                                           cnt_samples
from
   x
group by
   x.sql_id, x.sql_child_number, x.sql_exec_id,
   x.sql_exec_start,
   x.username,
   cast(substr(x.sql_text, 1, 1000) as varchar2(1000))
-- where
--    lower(substr(x.sql_text, 1, 1000)) like '%insert %tq84_table%'
order by
   min (case when x.first_rec_for_sql_exec =1 then x.sample_time end) desc
;
code }

sa:
  `â†’ development/databases/Oracle/installed/data-dictionary/hist/active_sess_history`
