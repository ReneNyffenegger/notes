$ Oracle multitenant architecture
@ multitenant architecture

The multitenant architecture enables a database to be a CDB.

The multitenant architecture allows for a separation of duties between a PDB administrator and a CDB administrator.

Starting with → development/databases/Oracle/Releases-and-versions/21c, Oracle supports multitenant architecture only.

{ Container Database CDB

? A *container database (CDB)* consists of
    • Zero, one or more *pluggable databases (PDB)* and
    • Zero, one or more *application containers*

  A CDB also has
    • Exactly one *CDB root container* (also referred to as the «root»)
    • Exactly one *system container*
    • Exactly one *seed PDB*

}
{ System container

  The system container is the CDB's *logical container* and contains
    • The root container
    • The CDB's PDBs.

}
{ Portable Database PDB

  A *portable database* (PDB) is a collection of
    • Schemas
    • Schema objects
    • Non-Schema objects

  A PDB belongs to zero or one application container.
  -
  If it  belongs to an application container, it is a *application PDB*.

  With regard to → development/databases/Oracle/Net, a PDB feels like an ordinary
  → development/databases/Oracle/architecture/database.

}
{ Application container

  An *application container* is an optional component of the CDB which stores stores
  → development/Data and → development/Data/metadata for «application back-ends».

  An application container consists of
    • Exactly one *application root* and
    • the PDBs plugged into this root.

}
{ Root container

  The root container stores the → development/Data/metadata which is required to manage the PDBs.

  The name of the root container is `CDB$ROOT`.

  Oracle recommends to use *AL32UTF8* for the root → development/Unicode/character-set.

}
{ Seed PDB

  The *seed PDB* is a system-supplied, read-only template from which new PDBs are created.

  The name of the seed PDB is `PDB$SEED`.

}
{ TODO

 `dbms_pdb`

  The procedure `dbms_pdb_num` (`→ Linux/fhs/u01/app/oracle/product/vv-v-v/dbhome_n/rdbms/admin/catfusrg_sql`) checks if Multitenant is used and counts user-created PDBs.

  Is the current database a CDB:
code {
select cdb from → development/databases/Oracle/installed/dynamic-performance-views/database;
code }

code {
select * from → development/databases/Oracle/installed/dynamic-performance-views/database where cdb = 'YES';
code }

code {
select
   sys_context('USERENV', 'CDB_NAME'),
   sys_context('USERENV', 'CON_NAME'), 
   sys_context('USERENV', 'APPLICATION_NAME')
from
   dual;
code }

code {
select * from containers(table_name);
select * from containers(table_name) where con_id <> sys_context('userenv', 'con_id');
code }

  `approot_to_pdb.sql`

code {

set lines 290
column name  format a12
column name_ format a12
select
   con.con_id,
   con_dbid_to_id    (con.dbid   ) con_id_,
   con_guid_to_id    (con.guid   ) con_id__,
   con_uid_to_id     (con.con_uid) con_id___,
   --
   con.con_uid,
   con.dbid,
   con_id_to_dbid    (con.con_id)  dbid_,
   --
   con.name,
   con_id_to_con_name(con.con_id) name_,
   --
   con.guid
from
   v$containers con;

code }

code {
select * from → development/databases/Oracle/installed/data-dictionary/properties[cdb_properties];
code }

code {
alter user … account unlock container=current';
code }

code {
select * from → development/databases/Oracle/installed/data-dictionary/base-tables/container[sys.container$];
code }

code {
select
                                        sys.dbms_registry.get_con_id(),
   sys.dbms_registry.get_container_name(sys.dbms_registry.get_con_id())
from
   dual;
code }

code {
select
   property_name, property_value
from → development/databases/Oracle/installed/data-dictionary/database/properties
where
   property_name in (
     'CON_VSN',
     'MAX_PDB_SNAPSHOTS',
     'PDB_UPGRADE_SYNC',
     'UPGRADE_PDB_ON_OPEN'
);
code }

  { Creating a pluggable database

code {
SQL> show pdbs
--
--     CON_ID CON_NAME                       OPEN MODE  RESTRICTED
-- ---------- ------------------------------ ---------- ----------
--          2 PDB$SEED                       READ ONLY  NO

SQL> create pluggable database tq84_pdb
--   as application container
     admin user rene_pdb identified by theSecret
--   file_name_convert = ('/pdbseed/', '/mydatabase/')
;

SQL> show pdbs
--
--     CON_ID CON_NAME                       OPEN MODE  RESTRICTED
-- ---------- ------------------------------ ---------- ----------
--          2 PDB$SEED                       READ ONLY  NO
--          3 TQ84_PDB                       MOUNTED

SQL> alter pluggable database tq84_pdb open;
SQL> show pdbs
--
--     CON_ID CON_NAME                       OPEN MODE  RESTRICTED
-- ---------- ------------------------------ ---------- ----------
--          2 PDB$SEED                       READ ONLY  NO
--          3 TQ84_PDB                       READ WRITE NO

SQL> select name from v$services;
SQL> select name from cdb_services;
--
-- …
-- tq84_pdb
-- …

SQL> select * from cdb_pdbs;
SQL> select * from dba_pdbs;

SQL> alter session set container = tq84_pdb;
SQL> alter session set container = pdb$seed;
code }

code {
lsrnctl service
code }

EZCONNECT?
code {
sqlplus sys@//localhost:1521/tq84_pdb as sysdba
SQL> show con_name
code }

  }

  { Objects related to application container

    Tables related to the application container seem to include:
     • `sys.fed$apps`
     • `sys.fed$patches`
     • `sys.fed$versions`
     • `sys.fed$statement$errors`
     • `sys.fed$app$status`
     • `sys.fed$binds`
     • `sys.fed$editions`
     • `sys.fed$dependency`

    Sequence
      • `app$con$seq`

  }

  { Data links, metadata links, extended data links

    DL = data link (formerly OBL); MDL = metadata link; EDL = extended data link

    The plan operation `→ development/databases/Oracle/SQL/statement/execution/plan/operations/extended-data-link/full`

    Columns
      • `SHARING` in `DBA_OBJECTS`
      • `EXTENDED_DATA_LINK` and `EXTENDED_DATA_LINK_MAP` in `DBA_TABLES` and `DBA_VIEWS`
      • `PDB_LOCAL_ONLY` in `DBA_VIEWS`

   `dbms_pdb_alter_sharing.set_metadata_linked`, `dbms_pdb_alter_sharing.set_data_linked`, `dbms_pdb_alter_sharing.set_ext_data_linked`

  }

}


sa:

  The init parameter `→ development/databases/Oracle/adminstration/init-parameters/enable/pluggable_database`

  `→ development/databases/Oracle/installed/dynamic-performance-views/pdbs`,
  `→ development/databases/Oracle/installed/dynamic-performance-views/containers`.
