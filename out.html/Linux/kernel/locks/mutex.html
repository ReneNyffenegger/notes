<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Kernel lock: mutex</title>
<link rel="stylesheet" type="text/css" href="file:///home/rene/github/github/notes/out.html//notes.css">
<script src='file:///home/rene/github/github/notes/out.html//q.js'></script>
</head>
<body>
Search notes: <input size='50' id='q' onchange='q();'>
<h1>Kernel lock: mutex</h1>
<div class='t'>
Mutexes enforce serialization on shared memory systems. Unlike <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/locks/spinlock.html'>spinlocks</a>, a process trying to acquire a mutex will suspend itself if it failes to acquire it. The process is then woken up when the mutex is available. This has the advantage that the CPU is free to persue another task. </div><div class='g'></div><div class='t'>
A mutex is represented by  <code>struct mutex</code>, defined in <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/source/include/linux/mutex_h.html'>include/linux/mutex.h</a>. </div>
<div class='h'><h2>Semantics</h2>
<div class='t'>
  A lock can be held/owner by at most one owner at a time. </div><div class='g'></div><div class='t'>
  Only this owner can release the lock when held. When a tasks holds   a mutex, it must not exit. </div><div class='g'></div><div class='t'>
  A mutex object must be initialized through an API, not via  <code>memset</code> or copying.   The memory containing the mutex may not be freed. </div><div class='g'></div><div class='t'>
  Mutexes may not be used in hardware or software    <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/interrupts.html'>interrupts</a> such as tasklets and timers. </div>
</div>
<div class='h'><h2>Code snippets</h2>
<div class='t'>
Statically define the mutex: </div><pre class='code'>DEFINE_MUTEX(name);
</pre><div class='g'></div><div class='t'>
Dynamically initialize the mutex: </div><pre class='code'>mutex_init(mutex);
</pre><div class='g'></div><div class='t'>
Acquire the mutex, uninterruptible </div><pre class='code'>void mutex_lock(struct mutex *lock);
void mutex_lock_nested(struct mutex *lock, unsigned int subclass);
int  mutex_trylock(struct mutex *lock);
</pre><div class='g'></div><div class='t'>
Acquire the mutex, interruptible: </div><pre class='code'>int mutex_lock_interruptible_nested(struct mutex *lock, unsigned int subclass);
int mutex_lock_interruptible(struct mutex *lock);
</pre><div class='g'></div><div class='t'>
Acquire the mutex, interruptible, if dec to 0: </div><pre class='code'>int atomic_dec_and_mutex_lock(atomic_t *cnt, struct mutex *lock);
</pre><div class='g'></div><div class='t'>
Unlock the mutex: </div><pre class='code'>void mutex_unlock(struct mutex *lock);
</pre><div class='g'></div><div class='t'>
Test if the mutex is taken: </div><pre class='code'>int mutex_is_locked(struct mutex *lock);
</pre>
</div>
<div class='h'><h2>CONFIG_DEBUG_MUTEXES</h2>
<div class='t'>
  When <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/CONFIG/DEBUG_MUTEXES.html'>CONFIG_DEBUG_MUTEXES</a> is enabled, violation of the   semantics are enforced and reported. </div>
</div>
<div class='h'><h2>TODO</h2>
<div class='t'>
  <i>futex</i>: Fast user space mutex. </div>
</div>
<div class='h'><h2>See also</h2>
<div class='t'>
  <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/locks/index.html'>Kernel locks</a>,   <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/locks/spinlock.html'>spninlocks</a>,   <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/source/include/linux/mutex_h.html'>include/linux/mutex.h</a>,   <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/source/kernel/locking/mutex_c.html'>kernel/locking/mutex.c</a>,   <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/source/Documentation/locking/mutex-design_txt.html'>Documentation/locking/mutex-design.txt</a>,   <a href='file:///home/rene/github/github/notes/out.html//Linux/kernel/source/Documentation/DocBook/genericirq_tmpl.html'>Documentation/DocBook/genericirq.tmpl</a> </div>
</div><hr><p><a href='file:///home/rene/github/github/notes/out.html//index.html'>Index</a><div class='bottom'></div></body>
</html>